{% extends 'meds/base.html' %}
{% block title %}–°–ø–∏—Å–æ–∫ –ø—Ä–µ–ø–∞—Ä–∞—Ç–æ–≤{% endblock %}
{% block content %}

<h2 class="text-3xl font-bold mb-4">–°–ø–∏—Å–æ–∫ –ø—Ä–µ–ø–∞—Ä–∞—Ç–æ–≤</h2>

<!-- üîç –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä -->
<form method="get" class="flex flex-wrap items-center gap-4 text-sm mb-4">
  <input type="text" name="search" value="{{ request.GET.search }}" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é"
         class="border px-3 py-1 rounded w-60">

  <span class="text-gray-600">–°—Ç–∞—Ç—É—Å:</span>
  <a href="{% url 'drug_list' %}?{% if request.GET.search %}search={{ request.GET.search }}&{% endif %}"
     class="{% if not active_filter %}font-semibold underline{% endif %} text-blue-600">–í—Å–µ</a>
  <a href="?{% if request.GET.search %}search={{ request.GET.search }}&{% endif %}status=ok"
     class="{% if active_filter == 'ok' %}font-semibold underline{% endif %} text-green-600">–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ</a>
  <a href="?{% if request.GET.search %}search={{ request.GET.search }}&{% endif %}status=soon"
     class="{% if active_filter == 'soon' %}font-semibold underline{% endif %} text-yellow-600">–ò—Å—Ç–µ–∫–∞—é—â–∏–µ</a>
  <a href="?{% if request.GET.search %}search={{ request.GET.search }}&{% endif %}status=expired"
     class="{% if active_filter == 'expired' %}font-semibold underline{% endif %} text-red-600">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ</a>

  <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded shadow">–ü–æ–∏—Å–∫</button>
</form>

<!-- ‚ûï –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
<div class="mb-6">
  <a href="{% url 'create_drug' %}" class="inline-block bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded shadow">
    ‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–ø–∞—Ä–∞—Ç
  </a>
</div>

<!-- üìÅ –§–∏–ª—å—Ç—Ä –∞–∫—Ç–∏–≤/–∞—Ä—Ö–∏–≤ -->
<div class="mb-4 space-x-4 text-sm">
  <span class="text-gray-600">–°—Ç–∞—Ç—É—Å:</span>
  <a href="{% url 'drug_list' %}" class="{% if not request.GET.archived %}font-semibold underline{% endif %} text-blue-600">–ê–∫—Ç–∏–≤–Ω—ã–µ</a>
  <a href="?archived=1" class="{% if request.GET.archived == '1' %}font-semibold underline{% endif %} text-gray-600">–ê—Ä—Ö–∏–≤</a>
</div>

<!-- üìã –¢–∞–±–ª–∏—Ü–∞ –ø—Ä–µ–ø–∞—Ä–∞—Ç–æ–≤ -->
<table class="w-full table-auto bg-white shadow rounded-lg">
  <thead>
    <tr class="bg-blue-100">
      <th class="px-4 py-2">–ù–∞–∑–≤–∞–Ω–∏–µ</th>
      <th class="px-4 py-2">–§–æ—Ä–º–∞</th>
      <th class="px-4 py-2">–°—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏</th>
      <th class="px-4 py-2">–û—Å—Ç–∞—Ç–æ–∫</th>
      <th class="px-4 py-2">–°—Ç–∞—Ç—É—Å</th>
      <th class="px-4 py-2">–î–µ–π—Å—Ç–≤–∏–µ</th>
    </tr>
  </thead>
  <tbody>
    {% for entry in page_obj %}
      {% with drug=entry.object status=entry.status %}
      <tr class="border-t">
        <td class="px-4 py-2">{{ drug.name }}</td>
        <td class="px-4 py-2">{{ drug.form }}</td>
        <td class="px-4 py-2">{{ drug.expiration_date }}</td>
        <td class="px-4 py-2">{{ drug.quantity }}</td>
        <td class="px-4 py-2">
          {% if status == 'expired' %}
            <span class="text-red-600 font-semibold">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω</span>
          {% elif status == 'soon' %}
            <span class="text-yellow-500 font-semibold">–°–∫–æ—Ä–æ –∏—Å—Ç–µ–∫–∞–µ—Ç</span>
          {% else %}
            <span class="text-green-600">–û–ö</span>
          {% endif %}
        </td>
        <td class="px-4 py-2 space-y-1">
          <a href="{% url 'create_movement' drug.id %}" class="block text-blue-600 hover:underline">‚ûï –î–≤–∏–∂–µ–Ω–∏–µ</a>
          <a href="{% url 'drug_history' drug.id %}" class="block text-gray-600 hover:underline">üìÑ –ò—Å—Ç–æ—Ä–∏—è</a>
          <a href="{% url 'edit_drug' drug.id %}" class="block text-indigo-600 hover:underline">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
          <a href="{% url 'toggle_archive_drug' drug.id %}" class="block text-red-600 hover:underline">
          {% if drug.is_archived %}
          ‚ôªÔ∏è –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
          {% else %}
          üóë –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å
          {% endif %}
        </a>
        </td>
      </tr>
      {% endwith %}
    {% empty %}
      <tr><td colspan="6" class="px-4 py-4 text-center text-gray-500">–ù–µ—Ç –ø—Ä–µ–ø–∞—Ä–∞—Ç–æ–≤</td></tr>
    {% endfor %}
  </tbody>
</table>

<!-- üìÑ –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º -->
<div class="mt-6 flex justify-center space-x-2">
  {% if page_obj.has_previous %}
    <a href="?{% if active_filter %}status={{ active_filter }}&{% endif %}{% if request.GET.search %}search={{ request.GET.search }}&{% endif %}page={{ page_obj.previous_page_number }}"
       class="px-3 py-1 bg-gray-200 hover:bg-gray-300 rounded">&laquo;</a>
  {% endif %}

  {% for num in page_obj.paginator.page_range %}
    {% if page_obj.number == num %}
      <span class="px-3 py-1 bg-blue-600 text-white rounded">{{ num }}</span>
    {% elif num >= page_obj.number|add:'-2' and num <= page_obj.number|add:'2' %}
      <a href="?{% if active_filter %}status={{ active_filter }}&{% endif %}{% if request.GET.search %}search={{ request.GET.search }}&{% endif %}page={{ num }}"
         class="px-3 py-1 bg-gray-200 hover:bg-gray-300 rounded">{{ num }}</a>
    {% endif %}
  {% endfor %}

  {% if page_obj.has_next %}
    <a href="?{% if active_filter %}status={{ active_filter }}&{% endif %}{% if request.GET.search %}search={{ request.GET.search }}&{% endif %}page={{ page_obj.next_page_number }}"
       class="px-3 py-1 bg-gray-200 hover:bg-gray-300 rounded">&raquo;</a>
  {% endif %}
</div>

{% endblock %}
